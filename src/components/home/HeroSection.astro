---
import Container from '../ui/Container.astro';
import CTAButton from '../etapa1/shared/CTAButton.astro';
import { getEntry } from 'astro:content';
import heroMobile from '../../assets/images/hersosectioninicio-mobile.webp';
import heroDesktop from '../../assets/images/hersosectioninicio-desktop.webp';

// Cargar frases desde archivo de contenido
let quotes = [
  'Cada persona es el arquitecto de su propia felicidad',
  'La aptitud física es el primer requisito de la felicidad',
  'La contrología es la coordinación completa de cuerpo, mente y espíritu',
  'La contrología no es un sistema de ejercicios al azar',
  'La contrología desarrolla el cuerpo uniformemente',
];

try {
  const quotesEntry = await getEntry('home', 'hero-quotes');
  if (quotesEntry?.data.quotes) {
    quotes = quotesEntry.data.quotes;
  }
} catch (error) {
  console.warn('No se pudo cargar hero-quotes.mdx:', error);
}
---

<section
  class="hero-section text-[var(--charcoal-gray)] py-12 md:py-16 relative"
  aria-label="Sección principal"
>
  <!-- Imagen de fondo animada -->
  <div
    class="hero-background-animated absolute inset-0"
    style={`--hero-mobile: url(${heroMobile.src}); --hero-desktop: url(${heroDesktop.src});`}
  >
  </div>

  <!-- Overlay rosa atenuante -->
  <div
    class="absolute inset-0 bg-gradient-to-br from-[var(--rose-pale)] via-[var(--cream)] to-[var(--warm-gray)] opacity-85 z-10"
  >
  </div>

  <Container>
    <div class="text-center relative z-20">
      <h1
        class="text-4xl md:text-6xl font-bold mb-6 animate-fade-in text-[var(--deep-coral)] hero-fade-in-up"
      >
        Bienestar Real para tu Vida Real
      </h1>

      <!-- Quote Rotator -->
      <div class="quote-container mb-8 hero-fade-in-up hero-delay-300">
        <blockquote
          class="text-xl md:text-2xl italic text-[var(--coral-primary)] opacity-90 transition-opacity duration-500"
          id="quote-display"
          role="status"
          aria-live="polite"
          aria-label="Frase inspiracional rotativa"
        >
          {quotes[0]}
        </blockquote>
        <p class="text-sm text-[var(--sage-green)] mt-2 font-medium">
          - Joseph Pilates
        </p>
      </div>

      <p
        class="text-lg md:text-xl mb-8 max-w-3xl mx-auto opacity-90 hero-fade-in-up hero-delay-600"
      >
        Descubre el poder del movimiento consciente con nuestras clases de
        Pilates personalizadas
      </p>

      <div
        class="flex flex-col sm:flex-row gap-4 justify-center mb-8 hero-fade-in-up hero-delay-900"
      >
        <CTAButton
          href="/servicios#clase-prueba"
          variant="primary"
          size="lg"
          icon="sparkles"
          tracking="hero_cta_click"
        >
          Agenda tu Clase de Prueba Gratis
        </CTAButton>
        <CTAButton
          href="/servicios"
          variant="outline"
          size="lg"
          class="text-[var(--coral-primary)] border-[var(--coral-primary)] hover:bg-[var(--rose-pale)]"
        >
          Conocer Servicios
        </CTAButton>
      </div>

      <!-- Trust Badges -->
      <div
        class="flex flex-col sm:flex-row gap-4 justify-center hero-fade-in-up hero-delay-1200"
        role="group"
        aria-label="Características destacadas"
      >
        <span
          class="inline-flex items-center bg-[var(--warm-gold)] text-white px-4 py-2 rounded-full text-sm font-semibold shadow-md hover:bg-[var(--warm-gold)]/90 transition-colors"
        >
          <svg
            class="w-4 h-4 mr-2"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"
            ></path>
          </svg>
          Máximo 6 Personas
        </span>
        <span
          class="inline-flex items-center bg-[var(--sage-green)] text-white px-4 py-2 rounded-full text-sm font-semibold shadow-md hover:bg-[var(--sage-green)]/90 transition-colors"
        >
          <svg
            class="w-4 h-4 mr-2"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"
            ></path>
          </svg>
          Profesionales Certificados
        </span>
        <span
          class="inline-flex items-center bg-[var(--trust-blue)] text-white px-4 py-2 rounded-full text-sm font-semibold shadow-md hover:bg-[var(--trust-blue)]/90 transition-colors"
        >
          <svg
            class="w-4 h-4 mr-2"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"
            ></path>
          </svg>
          Vitacura - 15 años
        </span>
      </div>
    </div>
  </Container>
</section>

<script define:vars={{ quotes }}>
  // Rotación de quotes
  const quoteDisplay = document.getElementById('quote-display');
  let currentQuoteIndex = 0;

  if (quoteDisplay && quotes && quotes.length > 0) {
    function rotateQuotes() {
      if (quoteDisplay) {
        quoteDisplay.style.opacity = '0';

        setTimeout(() => {
          currentQuoteIndex = (currentQuoteIndex + 1) % quotes.length;
          if (quoteDisplay) {
            quoteDisplay.textContent = quotes[currentQuoteIndex] || '';
            quoteDisplay.style.opacity = '1';
          }
        }, 500);
      }
    }

    // Rotar quotes cada 5 segundos
    setInterval(rotateQuotes, 5000);
  }

  // Controlar la animación de fondo completamente con JavaScript
  document.addEventListener('DOMContentLoaded', () => {
    const heroBackground = document.querySelector('.hero-background-animated');
    if (heroBackground) {
      // Desactivar animación CSS para controlar con JS
      heroBackground.style.animation = 'none';

      let startTime = Date.now();
      const cycleDuration = 20000; // 20 segundos

      function animateBackground() {
        const elapsed = (Date.now() - startTime) % cycleDuration;
        const progress = elapsed / cycleDuration; // 0 a 1

        // Calcular posición vertical (0% = abajo, 100% = arriba)
        let verticalPosition;
        let opacity;

        if (progress <= 0.15) {
          // 0% a 15%: aparece gradualmente en la parte inferior
          verticalPosition = 0;
          opacity = 0.1 + (progress / 0.15) * 0.6; // 0.1 a 0.7
        } else if (progress <= 0.85) {
          // 15% a 85%: se mueve de abajo hacia arriba
          const moveProgress = (progress - 0.15) / 0.7; // 0 a 1
          verticalPosition = moveProgress * 100; // 0% a 100%
          opacity = 0.7;
        } else {
          // 85% a 100%: desvanece en la parte superior
          verticalPosition = 100;
          opacity = 0.7 - ((progress - 0.85) / 0.15) * 0.6; // 0.7 a 0.1
        }

        // Aplicar las propiedades
        heroBackground.style.backgroundPosition = `center ${verticalPosition}%`;
        heroBackground.style.opacity = opacity.toString();

        requestAnimationFrame(animateBackground);
      }

      // Establecer estado inicial
      heroBackground.style.backgroundPosition = 'center 0%';
      heroBackground.style.opacity = '0.1';

      // Iniciar animación después de un breve delay
      setTimeout(() => {
        animateBackground();
      }, 100);
    }
  });
</script>

<style>
  /* ===== ANIMACIONES DE ENTRADA DE TEXTO (SOLO PARA HERO) ===== */

  /* Animación fadeInUp específica para el hero */
  @keyframes heroFadeInUp {
    0% {
      opacity: 0;
      transform: translateY(30px) scale(0.95);
    }
    100% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  .hero-fade-in-up {
    animation: heroFadeInUp 1s ease-out forwards;
    opacity: 0;
  }

  /* Delays específicos para elementos del hero */
  .hero-delay-300 {
    animation-delay: 0.3s;
  }

  .hero-delay-600 {
    animation-delay: 0.6s;
  }

  .hero-delay-900 {
    animation-delay: 0.9s;
  }

  .hero-delay-1200 {
    animation-delay: 1.2s;
  }

  /* ===== ESTILOS ORIGINALES DE FONDO (PRESERVADOS) ===== */

  /* Capa de imagen de fondo animada */
  .hero-background-animated {
    /* Imagen optimizada para móvil por defecto */
    background-image: var(--hero-mobile);
    background-size: cover;
    background-repeat: no-repeat;
    background-attachment: scroll; /* Mejor para móviles */
    background-position: center 0%; /* Empezar desde abajo */
    opacity: 0.1;
    z-index: 1;
    pointer-events: none; /* Evitar interferencias del mouse */
    will-change: background-position, opacity;
    transform: translateZ(0); /* Optimizar rendering */
  }

  /* Desktop: usar imagen de mayor resolución y fixed attachment */
  @media (min-width: 769px) {
    .hero-background-animated {
      background-image: var(--hero-desktop);
      background-attachment: fixed;
    }
  }

  /* Fallback para navegadores que no soporten WebP */
  @supports not (
    background-image:
      url('data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vuUAAA=')
  ) {
    .hero-background-animated {
      background-image: url('/images/hersosectioninicio.JPG');
    }
  }

  /* Mejorar contraste del texto sobre la imagen */
  .hero-section h1,
  .hero-section p,
  .hero-section blockquote {
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
  }

  /* ===== ACCESIBILIDAD (PRESERVANDO COMPORTAMIENTOS EXISTENTES) ===== */

  /* Respeta las preferencias de movimiento reducido */
  @media (prefers-reduced-motion: reduce) {
    .hero-background-animated {
      animation: none;
      background-position: center bottom;
      opacity: 0.7;
    }

    /* Desactivar animaciones de entrada si el usuario prefiere menos movimiento */
    .hero-fade-in-up {
      animation: none !important;
      opacity: 1 !important;
      transform: none !important;
    }
  }
</style>
